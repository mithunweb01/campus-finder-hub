<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>College Finder</title>

<link rel="canonical" href="https://mithunweb01.github.io/" />
<meta name="description" content="Find top engineering, medical, arts, and science colleges in Tamil Nadu.">
<meta name="keywords" content="Colleges in Chennai, Coimbatore, Pondicherry, Trichy, Madurai">
<meta name="author" content="Mithun">

<!-- Favicon -->
<link rel="icon" type="image/png" href="my-logo.png">

<style>
body {
    font-family: Arial;
    margin: 0;
    background: #eef5ff;
}

/* HEADER */
header {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    background: #fff;
    border-bottom: 1px solid #ddd;
}
header img {
    height: 45px;
    width: 45px;
    border-radius: 8px;
}

/* LAYOUT */
.container {
    display: flex;
    min-height: calc(100vh - 60px);
}

/* SIDEBAR */
.sidebar {
    width: 220px;
    background: #003366;
    color: #fff;
    padding-top: 10px;
    display: flex;
    flex-direction: column;
}
.tab-button {
    padding: 12px;
    border: none;
    background: none;
    color: #fff;
    text-align: left;
    font-size: 16px;
    cursor: pointer;
    border-left: 4px solid transparent;
}
.tab-button.active {
    background: #0055aa;
    border-left: 4px solid #ffcc00;
}

/* MOBILE SIDEBAR */
@media(max-width: 768px){
    .sidebar {
        width: 70px;
    }
    .tab-button {
        font-size: 0px;
        padding: 18px;
    }
    .tab-button::after {
        font-size: 18px;
    }
    .tab-button.active {
        border-left: none;
        border-bottom: 3px solid #ffcc00;
    }
}

/* CONTENT */
.content {
    flex: 1;
    padding: 20px;
    background: #f8fbff;
    overflow-y: auto;
}

/* POPUP */
#auth-popup {
    position: fixed;
    top: 0;
    left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.6);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 999;
}
#auth-box {
    background: white;
    padding: 20px;
    width: 300px;
    border-radius: 10px;
    text-align: center;
}
#auth-box input {
    width: 90%;
    padding: 8px;
    margin: 6px 0;
    border: 1px solid #aaa;
    border-radius: 5px;
}
#auth-box button {
    padding: 10px 14px;
    margin-top: 8px;
    background: #003366;
    color: #fff;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    width: 100%;
}

/* SUPPORT CHAT */
#support-box {
    max-width: 700px;
    margin: auto;
}
#chat-window {
    height: 350px;
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 10px;
    overflow-y: auto;
    margin-bottom: 10px;
}
.msg {
    padding: 6px 10px;
    margin: 6px 0;
    border-radius: 6px;
    max-width: 80%;
}
.user-msg {
    background: #d9eaff;
    margin-left: auto;
}
.ai-msg {
    background: #ffe9a8;
    margin-right: auto;
}

/* FLIPBOARDS */
.flipbox {
    background: white;
    width: 250px;
    padding: 15px;
    border-radius: 12px;
    display: inline-block;
    margin: 10px;
    box-shadow: 0 0 8px rgba(0,0,0,0.1);
}
.flipbox h3 { margin: 0; }
.flipbox button {
    margin-top: 10px;
    background: #003366;
    color: white;
    border: none;
    padding: 7px 12px;
    border-radius: 6px;
    cursor: pointer;
}
</style>

</head>
<body>

<header>
    <img src="my-logo.jpg">
    <h1>College Finder</h1>
</header>

<!-- LOGIN POPUP -->
<div id="auth-popup">
    <div id="auth-box">
        <h3 id="auth-title">Login</h3>
        <input id="username" placeholder="Username">
        <input id="dob" type="date">
        <button onclick="submitAuth()">Continue</button>
    </div>
</div>

<div class="container">

    <!-- SIDEBAR -->
    <nav class="sidebar" id="sidebar">
        <button class="tab-button active" onclick="openTab('home',event)">üè† Home</button>
        <button class="tab-button" onclick="requireLogin('chennai',event)">Chennai</button>
        <button class="tab-button" onclick="requireLogin('pondy',event)">Pondicherry</button>
        <button class="tab-button" onclick="requireLogin('coimbatore',event)">Coimbatore</button>
        <button class="tab-button" onclick="requireLogin('trichy',event)">Trichy</button>
        <button class="tab-button" onclick="requireLogin('madurai',event)">Madurai</button>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="content">

        <!-- HOME -->
        <section id="home" style="display:block;">
            <h1>Welcome to College Finder</h1>
            <p id="after-login-msg" style="display:none;background:#fff4c4;padding:10px;border-radius:8px;">
                üéâ You are logged in! Use the new <b>Support</b> tab to chat with AI and find colleges quickly.
            </p>
        </section>

        <!-- SUPPORT TAB -->
        <section id="support" style="display:none;"></section>

        <!-- CITY TABS -->
        <section id="chennai" style="display:none;"></section>
        <section id="pondy" style="display:none;"></section>
        <section id="coimbatore" style="display:none;"></section>
        <section id="trichy" style="display:none;"></section>
        <section id="madurai" style="display:none;"></section>

    </main>
</div>

<script>

const API_URL = "https://python-api-backend-K9994270777MIT.koyeb.app/search";

let loggedIn = false;
let isAdmin = false;

/* AUTO LOGIN (LOCAL STORAGE) */
if(localStorage.getItem("loggedIn") === "true"){
    loggedIn = true;
    createSupportTab();
    document.getElementById("after-login-msg").style.display="block";
}

/* REQUIRE LOGIN */
function requireLogin(tab,event){
    if(!loggedIn){
        event.preventDefault();
        showPopup();
        return;
    }
    openTab(tab,event);
}

/* LOGIN POPUP */
function showPopup(){
    document.getElementById("auth-popup").style.display="flex";
}

/* SUBMIT LOGIN */
function submitAuth(){
    let u = document.getElementById("username").value.trim();
    let d = document.getElementById("dob").value.trim();
    if(!u || !d){ alert("Enter all details"); return; }

    loggedIn = true;
    localStorage.setItem("loggedIn", "true");

    if(u === "Mithun" && d === "2014-11-15")
        isAdmin = true;

    document.getElementById("auth-popup").style.display="none";
    document.getElementById("after-login-msg").style.display="block";

    createSupportTab();
}

/* CREATE SUPPORT TAB */
function createSupportTab(){
    if(document.getElementById("support-tab-created")) return;

    let btn = document.createElement("button");
    btn.className = "tab-button";
    btn.id = "support-tab-created";
    btn.textContent = "üí¨ Support";
    btn.onclick = (e)=>openTab('support',e);
    document.getElementById("sidebar").appendChild(btn);

    document.getElementById("support").innerHTML = `
        <div id='support-box'>
            <h2>AI Support</h2>
            <div id='chat-window'></div>
            <input id='chat-input' placeholder='Ask about any college...' onkeydown="if(event.key==='Enter') sendMsg()">
        </div>`;
}

/* OPEN TAB */
function openTab(t,event){
    document.querySelectorAll('section').forEach(x=>x.style.display='none');
    if(event) {
        document.querySelectorAll('.tab-button').forEach(x=>x.classList.remove('active'));
        event.currentTarget.classList.add('active');
    }
    document.getElementById(t).style.display='block';
}

/* SEND CHAT MESSAGE */
async function sendMsg(){
    let input = document.getElementById('chat-input');
    let txt = input.value.trim();
    if(!txt) return;

    let win = document.getElementById('chat-window');
    win.innerHTML += `<div class='msg user-msg'>${txt}</div>`;
    input.value="";
    win.scrollTop = win.scrollHeight;

    // CALL BACKEND
    let r = await callBackendSearch(txt);

    win.innerHTML += `<div class='msg ai-msg'>${r}</div>`;
    win.scrollTop = win.scrollHeight;
}

/* CALL PYTHON BACKEND */
async function callBackendSearch(q){
    try{
        let res = await fetch(API_URL,{
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body: JSON.stringify({query:q, num_results:5})
        });

        let data = await res.json();

        /* If backend gives results */
        if(data && data.results){
            return data.results.map((r,i)=>`${i+1}. ${r.title}`).join("<br>");
        }

        return "No results or invalid API response.";
    }
    catch(err){
        return "‚ö†Ô∏è Backend not reachable. Please try again later.";
    }
}

</script>

</body>
</html>
